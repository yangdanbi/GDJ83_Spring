<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.winter.app.history.HistoryDAO">

  	<!-- 계좌이체 보내는쪽 -->
  	<insert id="add" parameterType="HistoryDTO">
  	<!-- 
		INSERT INTO HISTORY (
		  HISTORY_ID
		, ACCOUNT_NUMBER
		, HISTORY_TIME
		, AMOUNT
		, BALANCE
		, TYPE)
		VALUES(
				HISTORY_SEQ.NEXTVAL,#{account_number},SYSDATE,#{amount},
				(SELECT BALANCE 
				FROM PRODUCT_INFO
				WHERE ACCOUNT_NUMBER = #{account_number})+#{amount},#{type}
			  ) -->
			  
		INSERT INTO HISTORY (
		  HISTORY_ID
		, ACCOUNT_NUMBER
		, HISTORY_TIME
		, AMOUNT
		, BALANCE
		, TYPE)
			VALUES(
				HISTORY_SEQ.NEXTVAL,#{account_number},SYSDATE,#{amount},
				
			<choose>
				<when test="type == 'I'">
				(SELECT BALANCE 
				FROM PRODUCT_INFO
				WHERE ACCOUNT_NUMBER = #{reseive_number})+#{amount},#{type}
				</when>	
				<otherwise>
				(SELECT BALANCE 
				FROM PRODUCT_INFO
				WHERE ACCOUNT_NUMBER = #{account_number})-#{amount},#{type}
			
				</otherwise>
				
				</choose>
			  )
			  
	</insert>
	<update id="update" parameterType="HistoryDTO">
	<!-- history type 가 0이면 입금, 1이면 출금 -->
			
		UPDATE PRODUCT_INFO 
		SET BALANCE = BALANCE + #{amount}
		WHERE ACCOUNT_NUMBER = #{account_number}
	</update>
	

	
	  	<!-- 계좌이체 받는쪽 -->
	<!--  <insert id="transfer_u" parameterType="HistoryDTO" >
		INSERT INTO HISTORY 
		VALUES(HISTORY_SEQ.NEXTVAL,#{account_number},SYSDATE,#{amount},
				(SELECT BALANCE 
				FROM PRODUCT_INFO
				WHERE ACCOUNT_NUMBER = #{account_number})+#{amount},'I')
	</insert>
	

	
		계좌이체 받는쪽
	<update id="pro_up_u" parameterType="HistoryDTO" >
		UPDATE PRODUCT_INFO 
		SET BALANCE = BALANCE + #{amount}
		WHERE ACCOUNT_NUMBER = #{account_number}
	</update> -->
</mapper>